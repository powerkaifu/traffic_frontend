# ç³»çµ±æ¶æ§‹ç¸½è¦½

## ğŸ¯ ç³»çµ±ç›®æ¨™

æœ¬ç³»çµ±æ˜¯ä¸€å€‹åŸºæ–¼äººå·¥æ™ºæ…§çš„æ™ºèƒ½äº¤é€šç‡ˆæ§åˆ¶æ¨¡æ“¬å¹³å°ï¼Œä¸»è¦ç›®æ¨™åŒ…æ‹¬ï¼š

1. **äº¤é€šæµé‡æœ€ä½³åŒ–**ï¼šé€é AI é æ¸¬èª¿æ•´ç‡ˆè™Ÿæ™‚åºï¼Œæ¸›å°‘è»Šè¼›ç­‰å¾…æ™‚é–“
2. **çœŸå¯¦å ´æ™¯æ¨¡æ“¬**ï¼šæä¾›æ¥è¿‘çœŸå¯¦çš„è»Šè¼›è¡Œç‚ºå’Œäº¤é€šç’°å¢ƒæ¨¡æ“¬
3. **æ•¸æ“šæ”¶é›†åˆ†æ**ï¼šæ”¶é›†äº¤é€šæ•¸æ“šä¾› AI å­¸ç¿’å’Œæ±ºç­–
4. **è¦–è¦ºåŒ–ç›£æ§**ï¼šæä¾›ç›´è§€çš„äº¤é€šç‹€æ³é¡¯ç¤ºä»‹é¢

## ğŸ—ï¸ æ•´é«”æ¶æ§‹

### ç³»çµ±åˆ†å±¤æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä½¿ç”¨è€…ä»‹é¢å±¤                â”‚
â”‚    (Vue.js + Quasar Components)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              æ¥­å‹™é‚è¼¯å±¤                  â”‚
â”‚  TrafficLightController (æ ¸å¿ƒæ§åˆ¶å™¨)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              å¯¦é«”æ¨¡å‹å±¤                  â”‚
â”‚  Vehicle (è»Šè¼›)  â”‚  TrafficLight (ç‡ˆè™Ÿ) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              æ•¸æ“šé€šè¨Šå±¤                  â”‚
â”‚        API Integration (AIå¾Œç«¯)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              å‹•ç•«æ¸²æŸ“å±¤                  â”‚
â”‚        GSAP Animation Engine            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒçµ„ä»¶é—œä¿‚

```mermaid
graph TD
    A[IndexPage.vue] --> B[TrafficLightController]
    B --> C[TrafficLight]
    B --> D[Vehicle]
    B --> E[AI API Backend]
    D --> B
    C --> B

    F[User Interface] --> A
    A --> G[GSAP Animation]
    G --> H[DOM Rendering]
```

### ç³»çµ±é¡åˆ¥åœ–

```mermaid
classDiagram
    class TrafficLightController {
        -lights: Object
        -isRunning: boolean
        -currentPhase: string
        -observers: Array
        -currentLightStates: Object
        -dynamicTiming: Object
        -nextTiming: Object
        -vehicleData: Object
        -apiEndpoint: string
        +addObserver(callback)
        +removeObserver(callback)
        +notifyObservers(direction, state)
        +getCurrentLightState(direction)
        +updateLightState(direction, state)
        +updateVehicleData(direction, vehicleType)
        +collectIntersectionData()
        +sendDataToBackend()
        +resetVehicleData()
        +init(eastElement, westElement, southElement, northElement)
        +start()
        +stop()
        +runCycle()
        +getCurrentPhase()
    }

    class Vehicle {
        -id: string
        -vehicleType: string
        -direction: string
        -behavior: string
        -currentState: string
        -position: Object
        -element: HTMLElement
        -movementTimeline: Object
        -waitingForGreen: boolean
        -containerPosition: Object
        +createVehicle(type, direction, behavior, currentLights)$
        +move(allVehicles, trafficController)
        +onTrafficLightChange(lightStates)
        +canProceed(currentLights)
        +checkFrontCollision(allVehicles)
        +resumeMovement(allVehicles)
        +forceResumeMovement(allVehicles)
        +calculateAnimationTime()
        +calculateTurnPath()
        +executeLeftTurn()
        +executeRightTurn()
        +executeUTurn()
        +checkLayoutChange()
        +remove()
    }

    class TrafficLight {
        -direction: string
        -currentState: string
        -element: HTMLElement
        -container: HTMLElement
        +setState(newState)
        +updateVisualState()
        +canTransitionTo(newState)
        +getCurrentState()
    }

    class VehicleConfig {
        +configs: Object$
        +getConfig(type, direction)$
        +getVehicleImage(type, direction)$
        +getVehicleSize(type)$
    }

    class IndexPage {
        -trafficController: TrafficLightController
        -vehicles: Array
        -simulationRunning: boolean
        -vehicleGenerationProbability: number
        +initializeSimulation()
        +startSimulation()
        +stopSimulation()
        +generateVehicles()
        +removeCompletedVehicles()
        +updateUI()
    }

    TrafficLightController "1" *-- "4" TrafficLight : manages
    TrafficLightController "1" o-- "0..*" Vehicle : observes
    TrafficLightController ..> VehicleConfig : uses
    IndexPage "1" *-- "1" TrafficLightController : contains
    IndexPage "1" --> "0..*" Vehicle : creates
    Vehicle ..> VehicleConfig : uses
    Vehicle --> TrafficLightController : notifies
```

### è©³ç´°é¡åˆ¥çµæ§‹åœ–

```mermaid
classDiagram
    class TrafficLightController {
        <<Singleton>>
        -static instance: TrafficLightController
        -lights: Map~string, TrafficLight~
        -observers: Array~Function~
        -currentLightStates: Object
        -dynamicTiming: Object
        -nextTiming: Object
        -vehicleData: Object
        -apiEndpoint: string
        -onTimerUpdate: Function
        -onPredictionUpdate: Function
        +getInstance()$ TrafficLightController
        +addObserver(callback: Function) void
        +removeObserver(callback: Function) void
        +notifyObservers(direction: string, state: string) void
        +updateLightState(direction: string, state: string) void
        +collectIntersectionData() Array
        +sendDataToBackend() Promise
        +runCycle() Promise
    }

    class Vehicle {
        <<Entity>>
        -id: string
        -vehicleType: VehicleType
        -direction: Direction
        -behavior: BehaviorType
        -currentState: VehicleState
        -position: Position
        -element: HTMLElement
        -movementTimeline: GSAPTimeline
        -waitingForGreen: boolean
        -isAtStopLine: boolean
        -hasPassedStopLine: boolean
        +createVehicle(type, direction, behavior, lights)$ Vehicle
        +move(vehicles: Array, controller: TrafficLightController) void
        +canProceed(lights: Object) boolean
        +executeMovement() void
        +executeTurn(direction: string) void
        +checkCollision(vehicles: Array) Object
        +setState(newState: VehicleState) void
        +remove() void
    }

    class TrafficLight {
        <<Component>>
        -direction: Direction
        -currentState: LightState
        -element: HTMLElement
        -container: HTMLElement
        -validStates: Array~string~
        +setState(newState: LightState) void
        +updateVisualState() void
        +canTransitionTo(newState: LightState) boolean
        +getCurrentState() LightState
    }

    class VehicleConfig {
        <<Utility>>
        +configs: Map~string, Object~
        +getConfig(type: string, direction: string)$ Object
        +getVehicleImage(type: string, direction: string)$ string
        +getVehicleSize(type: string)$ Object
        +getSpeedRange(type: string)$ Object
    }

    %% åˆ—èˆ‰é¡å‹
    class VehicleType {
        <<enumeration>>
        SMALL
        MOTOR
        LARGE
    }

    class Direction {
        <<enumeration>>
        NORTH
        SOUTH
        EAST
        WEST
    }

    class BehaviorType {
        <<enumeration>>
        STRAIGHT
        LEFT
        RIGHT
        U_TURN
    }

    class VehicleState {
        <<enumeration>>
        WAITING
        MOVING
        TURNING
        WAITING_FOR_VEHICLE
        COMPLETED
    }

    class LightState {
        <<enumeration>>
        RED
        YELLOW
        GREEN
    }

    TrafficLightController "1" *-- "4" TrafficLight : manages
    TrafficLightController "1" o-- "0..*" Vehicle : observes
    Vehicle --> VehicleType : uses
    Vehicle --> Direction : uses
    Vehicle --> BehaviorType : uses
    Vehicle --> VehicleState : uses
    TrafficLight --> LightState : uses
    TrafficLight --> Direction : uses
    Vehicle ..> VehicleConfig : uses
    TrafficLightController ..> VehicleConfig : uses
```

## ğŸ”„ ç³»çµ±é‹ä½œæµç¨‹

### 1. åˆå§‹åŒ–éšæ®µ

1. **é é¢è¼‰å…¥**ï¼šIndexPage.vue åˆå§‹åŒ–äº¤é€šæ¨¡æ“¬ç’°å¢ƒ
2. **æ§åˆ¶å™¨å‰µå»º**ï¼šå»ºç«‹ TrafficLightController å¯¦ä¾‹
3. **ç‡ˆè™Ÿè¨­ç½®**ï¼šå‰µå»ºå››å€‹æ–¹å‘çš„ TrafficLight å¯¦ä¾‹
4. **å ´æ™¯æº–å‚™**ï¼šè¨­å®šè»Šé“ã€è·¯å£ç­‰è¦–è¦ºå…ƒç´ 

### 2. æ¨¡æ“¬é‹è¡Œéšæ®µ

1. **è»Šè¼›ç”Ÿæˆ**ï¼šæ ¹æ“šè¨­å®šçš„æ©Ÿç‡ç”¢ç”Ÿä¸åŒé¡å‹è»Šè¼›
2. **è¡Œç‚ºè¨ˆç®—**ï¼šè»Šè¼›æ ¹æ“šç‡ˆè™Ÿç‹€æ…‹æ±ºå®šè¡Œç‚ºï¼ˆåœæ­¢/å‰é€²/è½‰å½ï¼‰
3. **å‹•ç•«åŸ·è¡Œ**ï¼šGSAP è™•ç†è»Šè¼›ç§»å‹•å’Œè½‰å½å‹•ç•«
4. **ç‹€æ…‹æ›´æ–°**ï¼šæŒçºŒæ›´æ–°è»Šè¼›ä½ç½®å’Œäº¤é€šç‹€æ³

### 3. AI æ±ºç­–éšæ®µ

1. **æ•¸æ“šæ”¶é›†**ï¼šTrafficLightController æ”¶é›†ç•¶å‰äº¤é€šæ•¸æ“š
2. **API å‘¼å«**ï¼šå°‡æ•¸æ“šç™¼é€è‡³ AI å¾Œç«¯é€²è¡Œåˆ†æ
3. **æ±ºç­–å›æ‡‰**ï¼šæ¥æ”¶ AI çš„ç‡ˆè™Ÿåˆ‡æ›å»ºè­°
4. **ç‹€æ…‹åŸ·è¡Œ**ï¼šæ ¹æ“š AI å»ºè­°èª¿æ•´äº¤é€šç‡ˆç‹€æ…‹

## ğŸ“Š æ•¸æ“šæµå‘

### è¼¸å…¥æ•¸æ“š

- **ä½¿ç”¨è€…è¨­å®š**ï¼šè»Šè¼›ç”Ÿæˆæ©Ÿç‡ã€æ¨¡æ“¬åƒæ•¸
- **å³æ™‚ç‹€æ…‹**ï¼šç•¶å‰ç‡ˆè™Ÿã€è»Šè¼›ä½ç½®ã€ç­‰å¾…éšŠåˆ—

### è™•ç†æ•¸æ“š

- **è»Šè¼›çµ±è¨ˆ**ï¼šå„æ–¹å‘è»Šè¼›æ•¸é‡ã€é¡å‹åˆ†ä½ˆ
- **ç­‰å¾…æ™‚é–“**ï¼šå„è»Šé“å¹³å‡ç­‰å¾…æ™‚é–“
- **æµé‡å¯†åº¦**ï¼šè·¯å£è»Šæµå¯†åº¦åˆ†æ

### è¼¸å‡ºæ•¸æ“š

- **è¦–è¦ºå‘ˆç¾**ï¼šå‹•æ…‹è»Šè¼›ç§»å‹•ã€ç‡ˆè™Ÿè®ŠåŒ–
- **AI è¼¸å…¥**ï¼šæ ¼å¼åŒ–çš„äº¤é€šæ•¸æ“š
- **çµ±è¨ˆè³‡è¨Š**ï¼šäº¤é€šæ•ˆèƒ½æŒ‡æ¨™

## ğŸ® ä½¿ç”¨è€…äº’å‹•

### æ§åˆ¶ä»‹é¢

- **æ¨¡æ“¬æ§åˆ¶**ï¼šé–‹å§‹/æš«åœ/é‡ç½®æ¨¡æ“¬
- **åƒæ•¸è¨­å®š**ï¼šèª¿æ•´è»Šè¼›ç”Ÿæˆæ©Ÿç‡ã€å ´æ™¯åƒæ•¸
- **è¦–è¦ºåˆ‡æ›**ï¼šé–‹å•Ÿ/é—œé–‰å¯è¦–åŒ–æ•ˆæœ
- **æ•¸æ“šé¡¯ç¤º**ï¼šæŸ¥çœ‹å³æ™‚äº¤é€šçµ±è¨ˆ

### å³æ™‚å›é¥‹

- **è¦–è¦ºæŒ‡ç¤º**ï¼šè»Šè¼›ç‹€æ…‹ã€ç‡ˆè™Ÿè®ŠåŒ–
- **æ•¸æ“šæ›´æ–°**ï¼šå³æ™‚äº¤é€šçµ±è¨ˆé¡¯ç¤º
- **ç‹€æ…‹æç¤º**ï¼šç³»çµ±é‹è¡Œç‹€æ…‹æŒ‡ç¤º

## ğŸ”§ æŠ€è¡“ç‰¹é»

### é«˜æ•ˆèƒ½æ¸²æŸ“

- **GSAP å„ªåŒ–**ï¼šä½¿ç”¨ç¡¬é«”åŠ é€Ÿçš„å‹•ç•«å¼•æ“
- **DOM ç®¡ç†**ï¼šæœ€å°åŒ– DOM æ“ä½œæå‡æ•ˆèƒ½
- **ç‹€æ…‹ç®¡ç†**ï¼šç²¾ç¢ºçš„ç‹€æ…‹æ›´æ–°æ©Ÿåˆ¶

### æ¨¡çµ„åŒ–è¨­è¨ˆ

- **è·è²¬åˆ†é›¢**ï¼šæ¯å€‹é¡åˆ¥æœ‰æ˜ç¢ºçš„è·è²¬ç¯„åœ
- **ä½è€¦åˆåº¦**ï¼šçµ„ä»¶é–“é€éä»‹é¢é€šè¨Š
- **é«˜å…§èšæ€§**ï¼šç›¸é—œåŠŸèƒ½é›†ä¸­åœ¨åŒä¸€æ¨¡çµ„

### å¯æ“´å±•æ€§

- **è¨­è¨ˆæ¨¡å¼**ï¼šä½¿ç”¨å¤šç¨®è¨­è¨ˆæ¨¡å¼æå‡å¯ç¶­è­·æ€§
- **ä»‹é¢æ¨™æº–**ï¼šæ¨™æº–åŒ–çš„ API ä»‹é¢è¨­è¨ˆ
- **é…ç½®é©…å‹•**ï¼šé€éé…ç½®æª”æ¡ˆèª¿æ•´ç³»çµ±è¡Œç‚º

é€™å€‹æ¶æ§‹è¨­è¨ˆç¢ºä¿äº†ç³»çµ±çš„ç©©å®šæ€§ã€æ•ˆèƒ½å’Œå¯ç¶­è­·æ€§ï¼Œç‚ºæœªä¾†çš„åŠŸèƒ½æ“´å±•å’Œå„ªåŒ–æä¾›äº†è‰¯å¥½çš„åŸºç¤ã€‚

```

```
