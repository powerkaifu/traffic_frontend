# å•é¡Œæ’é™¤

## ğŸš¨ å¸¸è¦‹å•é¡Œåˆ†é¡

### ğŸ¨ å‹•ç•«èˆ‡è¦–è¦ºå•é¡Œ

### ğŸ”— API é€šè¨Šå•é¡Œ

### ğŸ§  é‚è¼¯èˆ‡ç‹€æ…‹å•é¡Œ

### âš¡ æ•ˆèƒ½å•é¡Œ

### ğŸ”§ é…ç½®èˆ‡ç’°å¢ƒå•é¡Œ

---

## ğŸ¨ å‹•ç•«èˆ‡è¦–è¦ºå•é¡Œ

### å•é¡Œ 1ï¼šè»Šè¼›å‹•ç•«å¡é “æˆ–ä¸æµæš¢

**ç—‡ç‹€**ï¼š

- è»Šè¼›ç§»å‹•æ™‚å‡ºç¾è·³èºæˆ–åœé “
- å‹•ç•«æ’­æ”¾é€Ÿåº¦ä¸ä¸€è‡´
- ç€è¦½å™¨ FPS éä½

**å¯èƒ½åŸå› **ï¼š

1. åŒæ™‚åŸ·è¡Œçš„å‹•ç•«æ•¸é‡éå¤š
2. DOM å…ƒç´ æ›´æ–°é »ç‡éé«˜
3. è¨˜æ†¶é«”æ´©æ¼å°è‡´æ•ˆèƒ½ä¸‹é™
4. GSAP æ™‚é–“è»¸è¡çª

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```javascript
// 1. æª¢æŸ¥å‹•ç•«æ•¸é‡
console.log('æ´»èºå‹•ç•«æ•¸é‡:', gsap.getTweensOf('*').length)

// 2. å¯¦ç¾å‹•ç•«æ± ç®¡ç†
class AnimationPool {
  constructor(maxAnimations = 20) {
    this.maxAnimations = maxAnimations
    this.activeAnimations = new Set()
  }

  addAnimation(tween) {
    if (this.activeAnimations.size >= this.maxAnimations) {
      this.killOldestAnimation()
    }
    this.activeAnimations.add(tween)

    tween.eventCallback('onComplete', () => {
      this.activeAnimations.delete(tween)
    })
  }
}

// 3. æª¢æŸ¥è¨˜æ†¶é«”ä½¿ç”¨
const checkMemoryUsage = () => {
  if (performance.memory) {
    console.log('è¨˜æ†¶é«”ä½¿ç”¨:', {
      used: Math.round(performance.memory.usedJSHeapSize / 1048576) + 'MB',
      total: Math.round(performance.memory.totalJSHeapSize / 1048576) + 'MB',
    })
  }
}

// 4. æ¸…ç†ç„¡æ•ˆçš„æ™‚é–“è»¸
const cleanupTimelines = () => {
  const vehicles = document.querySelectorAll('.vehicle')
  vehicles.forEach((vehicle) => {
    if (!vehicle.offsetParent) {
      // å…ƒç´ å·²è¢«ç§»é™¤
      gsap.killTweensOf(vehicle)
    }
  })
}
```

**é™¤éŒ¯æ­¥é©Ÿ**ï¼š

1. é–‹å•Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…· â†’ Performance é ç±¤
2. é–‹å§‹éŒ„è£½æ•ˆèƒ½ï¼ŒåŸ·è¡Œå‹•ç•«ä¸€æ®µæ™‚é–“
3. æª¢æŸ¥ FPS åœ–è¡¨å’Œä¸»åŸ·è¡Œç·’æ´»å‹•
4. æŸ¥çœ‹æ˜¯å¦æœ‰é•·æ™‚é–“åŸ·è¡Œçš„ä»»å‹™

### å•é¡Œ 2ï¼šè»Šè¼›è½‰å½è·¯å¾‘ä¸æ­£ç¢º

**ç—‡ç‹€**ï¼š

- è»Šè¼›è½‰å½æ™‚è·¯å¾‘ç•°å¸¸
- è»Šè¼›é‡ç–Šæˆ–ç¢°æ’
- è½‰å½åŠå¾‘ä¸ç¬¦åˆé æœŸ

**å¯èƒ½åŸå› **ï¼š

1. è½‰å½åº§æ¨™è¨ˆç®—éŒ¯èª¤
2. è·¯å¾‘é»è¨­å®šä¸ç•¶
3. å‹•ç•«æ™‚åºå•é¡Œ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```javascript
// 1. æª¢æŸ¥è½‰å½åº§æ¨™
const debugTurnPath = (vehicle) => {
  const path = vehicle.calculateTurnPath()
  console.log('è½‰å½è·¯å¾‘:', path)

  // è¦–è¦ºåŒ–è·¯å¾‘é»
  path.forEach((point, index) => {
    const marker = document.createElement('div')
    marker.style.cssText = `
            position: absolute;
            left: ${point.x}px;
            top: ${point.y}px;
            width: 5px;
            height: 5px;
            background: red;
            z-index: 1000;
        `
    marker.textContent = index
    document.body.appendChild(marker)

    setTimeout(() => marker.remove(), 5000)
  })
}

// 2. ä¿®æ­£è½‰å½è¨ˆç®—
const fixTurnCalculation = () => {
  // ç¢ºä¿è½‰å½åŠå¾‘åˆç†
  const minTurnRadius = 50
  const maxTurnRadius = 100

  // æ ¹æ“šè»Šè¼›é¡å‹èª¿æ•´è½‰å½åŠå¾‘
  const getTurnRadius = (vehicleType) => {
    switch (vehicleType) {
      case 'large':
        return maxTurnRadius
      case 'small':
        return minTurnRadius
      case 'motor':
        return minTurnRadius * 0.8
      default:
        return (minTurnRadius + maxTurnRadius) / 2
    }
  }
}
```

### å•é¡Œ 3ï¼šç‡ˆè™Ÿé¡¯ç¤ºç•°å¸¸

**ç—‡ç‹€**ï¼š

- ç‡ˆè™Ÿé¡è‰²ä¸æ­£ç¢º
- ç‡ˆè™Ÿåˆ‡æ›ä¸åŒæ­¥
- ç‡ˆè™Ÿåœ–ç‰‡ç„¡æ³•è¼‰å…¥

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```javascript
// 1. æª¢æŸ¥ç‡ˆè™Ÿç‹€æ…‹åŒæ­¥
const debugLightStates = () => {
  const controller = window.trafficController
  console.log('ç‡ˆè™Ÿç‹€æ…‹:', controller.getCurrentLightStates())

  // æª¢æŸ¥æ¯å€‹ç‡ˆè™Ÿçš„å¯¦éš› DOM ç‹€æ…‹
  Object.keys(controller.trafficLights).forEach((direction) => {
    const light = controller.trafficLights[direction]
    console.log(`${direction} ç‡ˆè™Ÿ:`, {
      state: light.currentState,
      element: light.element?.className,
      visible: light.element?.offsetParent !== null,
    })
  })
}

// 2. å¼·åˆ¶é‡æ–°æ•´ç†ç‡ˆè™Ÿé¡¯ç¤º
const refreshTrafficLights = () => {
  const controller = window.trafficController
  Object.values(controller.trafficLights).forEach((light) => {
    light.updateVisualState()
  })
}

// 3. æª¢æŸ¥åœ–ç‰‡è³‡æº
const checkImageResources = () => {
  const images = ['redLight.png', 'yellowLight.png', 'greenLight.png']
  images.forEach((img) => {
    const testImg = new Image()
    testImg.onload = () => console.log(`âœ“ ${img} è¼‰å…¥æˆåŠŸ`)
    testImg.onerror = () => console.error(`âœ— ${img} è¼‰å…¥å¤±æ•—`)
    testImg.src = `/images/light/${img}`
  })
}
```

---

## ğŸ”— API é€šè¨Šå•é¡Œ

### å•é¡Œ 4ï¼šAPI è«‹æ±‚å¤±æ•—æˆ–è¶…æ™‚

**ç—‡ç‹€**ï¼š

- ç„¡æ³•é€£æ¥åˆ°å¾Œç«¯ AI æœå‹™
- è«‹æ±‚å›æ‡‰æ™‚é–“éé•·
- æ”¶åˆ° CORS éŒ¯èª¤

**é™¤éŒ¯æ­¥é©Ÿ**ï¼š

```javascript
// 1. æª¢æŸ¥ API é€£ç·šç‹€æ…‹
const testAPIConnection = async () => {
  try {
    const response = await fetch('/api/health', {
      method: 'GET',
      timeout: 5000,
    })

    if (response.ok) {
      console.log('âœ“ API é€£ç·šæ­£å¸¸')
    } else {
      console.error('âœ— API å›æ‡‰éŒ¯èª¤:', response.status)
    }
  } catch (error) {
    console.error('âœ— API é€£ç·šå¤±æ•—:', error.message)

    // æª¢æŸ¥æ˜¯å¦ç‚º CORS å•é¡Œ
    if (error.message.includes('CORS')) {
      console.log('CORS å•é¡Œè§£æ±ºå»ºè­°:')
      console.log('1. æª¢æŸ¥å¾Œç«¯ CORS è¨­å®š')
      console.log('2. ç¢ºèª API ç¶²å€æ­£ç¢º')
      console.log('3. æª¢æŸ¥è«‹æ±‚æ¨™é ­è¨­å®š')
    }
  }
}

// 2. ç›£æ§ API æ•ˆèƒ½
class APIMonitor {
  constructor() {
    this.requestTimes = []
    this.errorCount = 0
  }

  recordRequest(startTime, success) {
    const responseTime = Date.now() - startTime
    this.requestTimes.push(responseTime)

    if (!success) this.errorCount++

    // ä¿æŒæœ€è¿‘ 100 æ¬¡è¨˜éŒ„
    if (this.requestTimes.length > 100) {
      this.requestTimes.shift()
    }

    this.reportStats()
  }

  reportStats() {
    const avg = this.requestTimes.reduce((a, b) => a + b, 0) / this.requestTimes.length
    const max = Math.max(...this.requestTimes)
    const errorRate = this.errorCount / this.requestTimes.length

    console.log('API æ•ˆèƒ½çµ±è¨ˆ:', {
      å¹³å‡å›æ‡‰æ™‚é–“: Math.round(avg) + 'ms',
      æœ€å¤§å›æ‡‰æ™‚é–“: max + 'ms',
      éŒ¯èª¤ç‡: Math.round(errorRate * 100) + '%',
    })
  }
}
```

### å•é¡Œ 5ï¼šæ•¸æ“šæ ¼å¼ä¸åŒ¹é…

**ç—‡ç‹€**ï¼š

- å¾Œç«¯å›å‚³æ ¼å¼éŒ¯èª¤
- æ•¸æ“šé©—è­‰å¤±æ•—
- AI å»ºè­°ç„¡æ³•è§£æ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```javascript
// 1. æ•¸æ“šæ ¼å¼é©—è­‰å™¨
const validateAPIData = (data) => {
  const schema = {
    timestamp: 'number',
    vehicles: 'object',
    currentLights: 'object',
    scene: 'string',
  }

  const errors = []

  Object.keys(schema).forEach((key) => {
    if (!(key in data)) {
      errors.push(`ç¼ºå°‘å¿…è¦æ¬„ä½: ${key}`)
    } else if (typeof data[key] !== schema[key]) {
      errors.push(`æ¬„ä½ ${key} é¡å‹éŒ¯èª¤: æœŸæœ› ${schema[key]}, å¾—åˆ° ${typeof data[key]}`)
    }
  })

  if (errors.length > 0) {
    console.error('æ•¸æ“šé©—è­‰å¤±æ•—:', errors)
    return false
  }

  return true
}

// 2. æ•¸æ“šæ ¼å¼è½‰æ›å™¨
const convertLegacyFormat = (oldData) => {
  // è½‰æ›èˆŠæ ¼å¼åˆ°æ–°æ ¼å¼
  if (oldData.vehicles && !oldData.vehicles.north) {
    // èˆŠæ ¼å¼è½‰æ›
    const newFormat = {
      timestamp: oldData.time || Date.now(),
      vehicles: {
        north: oldData.northVehicles || { motor: 0, small: 0, large: 0 },
        south: oldData.southVehicles || { motor: 0, small: 0, large: 0 },
        east: oldData.eastVehicles || { motor: 0, small: 0, large: 0 },
        west: oldData.westVehicles || { motor: 0, small: 0, large: 0 },
      },
      currentLights: oldData.lights || {},
      scene: oldData.scenario || 'ä¸€èˆ¬',
    }

    console.log('å·²è½‰æ›èˆŠæ ¼å¼æ•¸æ“š')
    return newFormat
  }

  return oldData
}
```

---

## ğŸ§  é‚è¼¯èˆ‡ç‹€æ…‹å•é¡Œ

### å•é¡Œ 6ï¼šè»Šè¼›ç‹€æ…‹ç•°å¸¸

**ç—‡ç‹€**ï¼š

- è»Šè¼›å¡åœ¨æŸå€‹ç‹€æ…‹
- ç‹€æ…‹è½‰æ›é‚è¼¯éŒ¯èª¤
- è»Šè¼›ç„¡æ³•æ­£å¸¸ç§»é™¤

**é™¤éŒ¯æ–¹æ³•**ï¼š

```javascript
// 1. è»Šè¼›ç‹€æ…‹è¿½è¹¤å™¨
class VehicleStateTracker {
  constructor() {
    this.stateHistory = new Map()
  }

  trackVehicle(vehicle) {
    if (!this.stateHistory.has(vehicle.id)) {
      this.stateHistory.set(vehicle.id, [])
    }

    const history = this.stateHistory.get(vehicle.id)
    history.push({
      state: vehicle.currentState,
      timestamp: Date.now(),
      position: { ...vehicle.position },
    })

    // æª¢æŸ¥æ˜¯å¦å¡åœ¨æŸå€‹ç‹€æ…‹éä¹…
    this.checkStuckState(vehicle.id, history)
  }

  checkStuckState(vehicleId, history) {
    if (history.length < 10) return

    const recent = history.slice(-10)
    const sameState = recent.every((h) => h.state === recent[0].state)
    const timeDiff = recent[recent.length - 1].timestamp - recent[0].timestamp

    if (sameState && timeDiff > 30000) {
      // 30ç§’
      console.warn(`è»Šè¼› ${vehicleId} å¯èƒ½å¡åœ¨ç‹€æ…‹ ${recent[0].state}`)
      this.debugVehicleState(vehicleId)
    }
  }

  debugVehicleState(vehicleId) {
    const vehicle = this.findVehicleById(vehicleId)
    if (vehicle) {
      console.log('è»Šè¼›ç‹€æ…‹è¨ºæ–·:', {
        id: vehicle.id,
        state: vehicle.currentState,
        position: vehicle.position,
        canProceed: vehicle.canProceed(window.trafficController.getCurrentLightStates()),
        hasElement: !!vehicle.element,
        hasTimeline: !!vehicle.timeline,
      })
    }
  }
}

// 2. ç‹€æ…‹ä¿®å¾©å·¥å…·
const fixVehicleState = (vehicleId) => {
  const vehicle = window.trafficController.vehicles.find((v) => v.id === vehicleId)
  if (!vehicle) {
    console.error('æ‰¾ä¸åˆ°è»Šè¼›:', vehicleId)
    return
  }

  // å¼·åˆ¶é‡ç½®ç‹€æ…‹
  if (vehicle.timeline) {
    vehicle.timeline.kill()
  }

  vehicle.currentState = 'waiting'
  vehicle.move()

  console.log('å·²é‡ç½®è»Šè¼›ç‹€æ…‹:', vehicleId)
}
```

### å•é¡Œ 7ï¼šäº¤é€šç‡ˆåŒæ­¥å•é¡Œ

**ç—‡ç‹€**ï¼š

- å¤šå€‹æ–¹å‘åŒæ™‚é¡¯ç¤ºç¶ ç‡ˆ
- ç‡ˆè™Ÿåˆ‡æ›ä¸å”èª¿
- ç›¸ä½é‚è¼¯éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```javascript
// 1. ç‡ˆè™ŸåŒæ­¥æª¢æŸ¥å™¨
const validateTrafficLightSync = () => {
  const controller = window.trafficController
  const states = controller.getCurrentLightStates()

  const issues = []

  // æª¢æŸ¥æ˜¯å¦æœ‰å¤šå€‹æ–¹å‘åŒæ™‚ç¶ ç‡ˆ
  const greenDirections = Object.keys(states).filter((dir) => states[dir] === 'green')
  if (greenDirections.length > 2) {
    issues.push('å¤šå€‹æ–¹å‘åŒæ™‚ç¶ ç‡ˆ')
  }

  // æª¢æŸ¥å°å‘ç‡ˆè™Ÿæ˜¯å¦ä¸€è‡´
  if (states.north !== states.south) {
    issues.push('å—åŒ—å‘ç‡ˆè™Ÿä¸ä¸€è‡´')
  }
  if (states.east !== states.west) {
    issues.push('æ±è¥¿å‘ç‡ˆè™Ÿä¸ä¸€è‡´')
  }

  if (issues.length > 0) {
    console.error('ç‡ˆè™ŸåŒæ­¥å•é¡Œ:', issues)
    return false
  }

  console.log('âœ“ ç‡ˆè™ŸåŒæ­¥æ­£å¸¸')
  return true
}

// 2. å¼·åˆ¶ç‡ˆè™ŸåŒæ­¥
const forceLightSync = () => {
  const controller = window.trafficController

  // é‡ç½®åˆ°å®‰å…¨ç‹€æ…‹ï¼ˆå…¨ç´…ç‡ˆï¼‰
  const safeState = {
    north: 'red',
    south: 'red',
    east: 'red',
    west: 'red',
  }

  controller.updateTrafficLights(safeState)

  // 3ç§’å¾Œæ¢å¾©æ­£å¸¸ç›¸ä½
  setTimeout(() => {
    controller.switchLights()
  }, 3000)

  console.log('å·²å¼·åˆ¶åŒæ­¥ç‡ˆè™Ÿ')
}
```

---

## âš¡ æ•ˆèƒ½å•é¡Œ

### å•é¡Œ 8ï¼šè¨˜æ†¶é«”æ´©æ¼

**ç—‡ç‹€**ï¼š

- è¨˜æ†¶é«”ä½¿ç”¨é‡æŒçºŒå¢åŠ 
- é é¢è®Šæ…¢æˆ–ç•¶æ©Ÿ
- å¤§é‡ DOM å…ƒç´ æœªæ¸…ç†

**æª¢æ¸¬èˆ‡ä¿®å¾©**ï¼š

```javascript
// 1. è¨˜æ†¶é«”æ´©æ¼æª¢æ¸¬å™¨
class MemoryLeakDetector {
  constructor() {
    this.initialMemory = this.getMemoryUsage()
    this.samples = []
    this.interval = null
  }

  startMonitoring(intervalMs = 10000) {
    this.interval = setInterval(() => {
      this.takeSample()
    }, intervalMs)
  }

  takeSample() {
    const current = this.getMemoryUsage()
    this.samples.push({
      timestamp: Date.now(),
      memory: current,
    })

    // ä¿æŒæœ€è¿‘ 20 å€‹æ¨£æœ¬
    if (this.samples.length > 20) {
      this.samples.shift()
    }

    this.analyzeMemoryTrend()
  }

  analyzeMemoryTrend() {
    if (this.samples.length < 5) return

    const recent = this.samples.slice(-5)
    const increasing = recent.every((sample, index) => {
      if (index === 0) return true
      return sample.memory > recent[index - 1].memory
    })

    if (increasing) {
      const growth = recent[recent.length - 1].memory - recent[0].memory
      if (growth > 10) {
        // 10MB å¢é•·
        console.warn('åµæ¸¬åˆ°å¯èƒ½çš„è¨˜æ†¶é«”æ´©æ¼')
        this.reportLeakSources()
      }
    }
  }

  reportLeakSources() {
    console.log('è¨˜æ†¶é«”æ´©æ¼åˆ†æ:')
    console.log('è»Šè¼›æ•¸é‡:', document.querySelectorAll('.vehicle').length)
    console.log('GSAP å‹•ç•«æ•¸é‡:', gsap.getTweensOf('*').length)
    console.log('äº‹ä»¶ç›£è½å™¨æ•¸é‡:', this.countEventListeners())
  }

  getMemoryUsage() {
    return performance.memory ? Math.round(performance.memory.usedJSHeapSize / 1048576) : 0
  }
}

// 2. è¨˜æ†¶é«”æ¸…ç†å·¥å…·
const performMemoryCleanup = () => {
  // æ¸…ç†å·²ç§»é™¤çš„è»Šè¼› DOM å…ƒç´ 
  const vehicleElements = document.querySelectorAll('.vehicle')
  vehicleElements.forEach((element) => {
    if (!element.offsetParent) {
      element.remove()
    }
  })

  // æ¸…ç†ç„¡æ•ˆçš„ GSAP å‹•ç•«
  gsap.getTweensOf('*').forEach((tween) => {
    if (!tween.target || !document.contains(tween.target)) {
      tween.kill()
    }
  })

  // è§¸ç™¼åƒåœ¾å›æ”¶ï¼ˆåƒ…åœ¨é–‹ç™¼ç’°å¢ƒï¼‰
  if (window.gc && typeof window.gc === 'function') {
    window.gc()
  }

  console.log('è¨˜æ†¶é«”æ¸…ç†å®Œæˆ')
}
```

### å•é¡Œ 9ï¼šFPS ä¸‹é™

**ç—‡ç‹€**ï¼š

- å‹•ç•«ä¸æµæš¢
- é é¢å›æ‡‰é²ç·©
- CPU ä½¿ç”¨ç‡éé«˜

**å„ªåŒ–ç­–ç•¥**ï¼š

```javascript
// 1. FPS ç›£æ§å™¨
class FPSMonitor {
  constructor() {
    this.fps = 0
    this.frameCount = 0
    this.lastTime = performance.now()
    this.startMonitoring()
  }

  startMonitoring() {
    const updateFPS = (currentTime) => {
      this.frameCount++

      if (currentTime - this.lastTime >= 1000) {
        this.fps = this.frameCount
        this.frameCount = 0
        this.lastTime = currentTime

        this.checkPerformance()
      }

      requestAnimationFrame(updateFPS)
    }

    requestAnimationFrame(updateFPS)
  }

  checkPerformance() {
    if (this.fps < 30) {
      console.warn(`FPS éä½: ${this.fps}`)
      this.suggestOptimizations()
    }
  }

  suggestOptimizations() {
    const vehicleCount = document.querySelectorAll('.vehicle').length
    const animationCount = gsap.getTweensOf('*').length

    console.log('æ•ˆèƒ½å„ªåŒ–å»ºè­°:')
    if (vehicleCount > 50) {
      console.log('- è»Šè¼›æ•¸é‡éå¤šï¼Œè€ƒæ…®é™åˆ¶åŒæ™‚å­˜åœ¨çš„è»Šè¼›æ•¸')
    }
    if (animationCount > 100) {
      console.log('- å‹•ç•«æ•¸é‡éå¤šï¼Œè€ƒæ…®ä½¿ç”¨å‹•ç•«æ± ç®¡ç†')
    }
  }
}

// 2. å‹•ç•«å„ªåŒ–å™¨
class AnimationOptimizer {
  constructor() {
    this.maxConcurrentAnimations = 30
    this.animationQueue = []
    this.activeAnimations = new Set()
  }

  addAnimation(animationFn) {
    if (this.activeAnimations.size < this.maxConcurrentAnimations) {
      this.executeAnimation(animationFn)
    } else {
      this.animationQueue.push(animationFn)
    }
  }

  executeAnimation(animationFn) {
    const animation = animationFn()
    this.activeAnimations.add(animation)

    animation.eventCallback('onComplete', () => {
      this.activeAnimations.delete(animation)
      this.processQueue()
    })
  }

  processQueue() {
    if (this.animationQueue.length > 0 && this.activeAnimations.size < this.maxConcurrentAnimations) {
      const nextAnimation = this.animationQueue.shift()
      this.executeAnimation(nextAnimation)
    }
  }
}
```

---

## ğŸ”§ é…ç½®èˆ‡ç’°å¢ƒå•é¡Œ

### å•é¡Œ 10ï¼šé–‹ç™¼ç’°å¢ƒé…ç½®éŒ¯èª¤

**å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ**ï¼š

```bash
# 1. ä¾è³´å®‰è£å•é¡Œ
npm cache clean --force
rm -rf node_modules package-lock.json
npm install

# 2. ç«¯å£è¡çª
# ä¿®æ”¹ quasar.config.js
devServer: {
  port: 9001, // æ”¹ç”¨å…¶ä»–ç«¯å£
  open: true
}

# 3. ç’°å¢ƒè®Šæ•¸å•é¡Œ
# æª¢æŸ¥ .env æ–‡ä»¶æ˜¯å¦å­˜åœ¨
cat .env.development

# 4. å»ºç½®å•é¡Œ
npm run clean
npm run build
```

### å•é¡Œ 11ï¼šç€è¦½å™¨ç›¸å®¹æ€§

**æª¢æŸ¥æ¸…å–®**ï¼š

```javascript
// 1. ç€è¦½å™¨åŠŸèƒ½æª¢æ¸¬
const checkBrowserSupport = () => {
  const features = {
    webGL: !!window.WebGLRenderingContext,
    requestAnimationFrame: !!window.requestAnimationFrame,
    classList: !!document.documentElement.classList,
    addEventListener: !!window.addEventListener,
    JSON: !!window.JSON,
    performance: !!window.performance,
  }

  const unsupported = Object.keys(features).filter((key) => !features[key])

  if (unsupported.length > 0) {
    console.error('ç€è¦½å™¨ä¸æ”¯æ´ä»¥ä¸‹åŠŸèƒ½:', unsupported)
    alert('æ‚¨çš„ç€è¦½å™¨ç‰ˆæœ¬éèˆŠï¼Œè«‹å‡ç´šåˆ°æœ€æ–°ç‰ˆæœ¬ä»¥ç²å¾—æœ€ä½³é«”é©—')
  } else {
    console.log('âœ“ ç€è¦½å™¨æ”¯æ´æª¢æŸ¥é€šé')
  }

  return unsupported.length === 0
}

// 2. é™ç´šè™•ç†
const enableFallbackMode = () => {
  console.log('å•Ÿç”¨é™ç´šæ¨¡å¼')

  // ç¦ç”¨è¤‡é›œå‹•ç•«
  window.DISABLE_ANIMATIONS = true

  // æ¸›å°‘è»Šè¼›æ•¸é‡
  window.MAX_VEHICLES = 10

  // ç°¡åŒ–è¦–è¦ºæ•ˆæœ
  document.body.classList.add('low-performance-mode')
}
```

## ğŸ“‹ é™¤éŒ¯å·¥å…·ç®±

### å…¨åŸŸé™¤éŒ¯å·¥å…·

```javascript
// æ·»åŠ åˆ°ç€è¦½å™¨æ§åˆ¶å°çš„å…¨åŸŸå·¥å…·
window.debugTools = {
  // å–å¾—äº¤é€šæ§åˆ¶å™¨
  getController: () => window.trafficController,

  // åˆ—å‡ºæ‰€æœ‰è»Šè¼›
  listVehicles: () => window.trafficController?.vehicles || [],

  // å¼·åˆ¶ç§»é™¤æ‰€æœ‰è»Šè¼›
  clearAllVehicles: () => {
    const controller = window.trafficController
    if (controller) {
      controller.vehicles.forEach((v) => v.remove?.())
      controller.vehicles = []
    }
  },

  // é‡ç½®ç³»çµ±
  resetSystem: () => {
    window.location.reload()
  },

  // æ•ˆèƒ½çµ±è¨ˆ
  getPerformanceStats: () => ({
    vehicles: document.querySelectorAll('.vehicle').length,
    animations: gsap.getTweensOf('*').length,
    memory: performance.memory ? Math.round(performance.memory.usedJSHeapSize / 1048576) + 'MB' : 'N/A',
  }),

  // æ¨¡æ“¬ API éŒ¯èª¤
  simulateAPIError: () => {
    window.FORCE_API_ERROR = true
    console.log('API éŒ¯èª¤æ¨¡æ“¬å·²å•Ÿç”¨')
  },
}

console.log('é™¤éŒ¯å·¥å…·å·²è¼‰å…¥ï¼Œä½¿ç”¨ debugTools ç‰©ä»¶å­˜å–')
```

é€™å€‹å•é¡Œæ’é™¤æŒ‡å—æä¾›äº†ç³»çµ±å¯èƒ½é‡åˆ°çš„ä¸»è¦å•é¡ŒåŠå…¶è§£æ±ºæ–¹æ¡ˆï¼Œå¹«åŠ©é–‹ç™¼è€…å¿«é€Ÿè¨ºæ–·å’Œä¿®å¾©å•é¡Œï¼Œç¢ºä¿ç³»çµ±ç©©å®šé‹è¡Œã€‚
