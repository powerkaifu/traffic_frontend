# è¨­è¨ˆæ¨¡å¼æ‡‰ç”¨

## ğŸ¯ è¨­è¨ˆæ¨¡å¼é¸æ“‡åŸå‰‡

æœ¬ç³»çµ±æ¡ç”¨å¤šç¨®è¨­è¨ˆæ¨¡å¼çš„çµ„åˆï¼Œæ¯å€‹æ¨¡å¼çš„é¸æ“‡éƒ½åŸºæ–¼ç‰¹å®šçš„æ¥­å‹™éœ€æ±‚å’ŒæŠ€è¡“è€ƒé‡ï¼š

1. **è·è²¬åˆ†é›¢**ï¼šç¢ºä¿æ¯å€‹é¡åˆ¥æœ‰æ˜ç¢ºçš„å–®ä¸€è·è²¬
2. **é¬†æ•£è€¦åˆ**ï¼šé™ä½çµ„ä»¶é–“çš„ä¾è³´é—œä¿‚
3. **é«˜å…§èšæ€§**ï¼šç›¸é—œåŠŸèƒ½é›†ä¸­ç®¡ç†
4. **å¯æ“´å±•æ€§**ï¼šä¾¿æ–¼æœªä¾†åŠŸèƒ½æ“´å±•å’Œä¿®æ”¹
5. **å¯ç¶­è­·æ€§**ï¼šæå‡ä»£ç¢¼çš„å¯è®€æ€§å’Œç¶­è­·æ€§

## ğŸ—ï¸ TrafficLightController è¨­è¨ˆæ¨¡å¼

### Observer Patternï¼ˆè§€å¯Ÿè€…æ¨¡å¼ï¼‰

**æ‡‰ç”¨åŸå› **ï¼š

- è»Šè¼›éœ€è¦å³æ™‚æ„ŸçŸ¥ç‡ˆè™Ÿè®ŠåŒ–
- ç³»çµ±ç‹€æ…‹è®ŠåŒ–éœ€è¦é€šçŸ¥å¤šå€‹çµ„ä»¶
- å¯¦ç¾é¬†æ•£è€¦åˆçš„äº‹ä»¶é€šçŸ¥æ©Ÿåˆ¶

**å¯¦ç¾æ–¹å¼**ï¼š

```javascript
// è»Šè¼›è¨»å†Šç‚ºè§€å¯Ÿè€…
registerVehicle(vehicle) {
    this.vehicles.push(vehicle);
}

// ç‡ˆè™Ÿè®ŠåŒ–é€šçŸ¥æ‰€æœ‰è»Šè¼›
updateTrafficLights(lightStates) {
    this.vehicles.forEach(vehicle => {
        vehicle.onTrafficLightChange(lightStates);
    });
}
```

**å„ªé»**ï¼š

- æ”¯æ´ä¸€å°å¤šçš„ä¾è³´é—œä¿‚
- å‹•æ…‹å¢æ¸›è§€å¯Ÿè€…
- é™ä½ä¸»é«”å’Œè§€å¯Ÿè€…é–“çš„è€¦åˆ

### Singleton Patternï¼ˆå–®ä¾‹æ¨¡å¼ï¼‰

**æ‡‰ç”¨åŸå› **ï¼š

- ç¢ºä¿æ•´å€‹ç³»çµ±åªæœ‰ä¸€å€‹äº¤é€šæ§åˆ¶ä¸­å¿ƒ
- é¿å…å¤šå€‹æ§åˆ¶å™¨è¡çª
- æä¾›å…¨åŸŸå­˜å–é»

**å¯¦ç¾æ–¹å¼**ï¼š

```javascript
class TrafficLightController {
  constructor() {
    if (TrafficLightController.instance) {
      return TrafficLightController.instance
    }
    // åˆå§‹åŒ–é‚è¼¯
    TrafficLightController.instance = this
  }
}
```

**å„ªé»**ï¼š

- ç¢ºä¿å¯¦ä¾‹å”¯ä¸€æ€§
- æä¾›å…¨åŸŸå­˜å–é»
- å»¶é²åˆå§‹åŒ–ç¯€ç´„è³‡æº

### State Patternï¼ˆç‹€æ…‹æ¨¡å¼ï¼‰

**æ‡‰ç”¨åŸå› **ï¼š

- ç‡ˆè™Ÿæ§åˆ¶æœ‰æ˜ç¢ºçš„ç‹€æ…‹è½‰æ›
- ä¸åŒç‹€æ…‹ä¸‹çš„è¡Œç‚ºå·®ç•°å¾ˆå¤§
- éœ€è¦æ”¯æ´è¤‡é›œçš„ç‹€æ…‹è½‰æ›é‚è¼¯

**å¯¦ç¾æ–¹å¼**ï¼š

```javascript
// ç‹€æ…‹è½‰æ›é‚è¼¯
switchLights() {
    const currentPhase = this.getCurrentPhase();
    const nextPhase = this.getNextPhase(currentPhase);
    this.transitionToPhase(nextPhase);
}
```

**å„ªé»**ï¼š

- ç‹€æ…‹è½‰æ›é‚è¼¯æ¸…æ™°
- æ˜“æ–¼æ“´å±•æ–°ç‹€æ…‹
- é¿å…å¤§é‡æ¢ä»¶åˆ¤æ–·

## ğŸš— Vehicle è¨­è¨ˆæ¨¡å¼

### Factory Patternï¼ˆå·¥å» æ¨¡å¼ï¼‰

**æ‡‰ç”¨åŸå› **ï¼š

- éœ€è¦æ ¹æ“šä¸åŒåƒæ•¸å‰µå»ºä¸åŒé¡å‹è»Šè¼›
- è»Šè¼›å‰µå»ºé‚è¼¯è¤‡é›œï¼Œéœ€è¦çµ±ä¸€ç®¡ç†
- æ”¯æ´å‹•æ…‹è»Šè¼›é¡å‹æ“´å±•

**å¯¦ç¾æ–¹å¼**ï¼š

```javascript
static createVehicle(type, direction, behavior, currentLights) {
    const config = VehicleConfig.getConfig(type, direction);
    return new Vehicle(config, behavior, currentLights);
}
```

**å„ªé»**ï¼š

- å‰µå»ºé‚è¼¯é›†ä¸­ç®¡ç†
- æ˜“æ–¼æ“´å±•æ–°è»Šå‹
- éš±è—è¤‡é›œçš„å‰µå»ºéç¨‹

### Strategy Patternï¼ˆç­–ç•¥æ¨¡å¼ï¼‰

**æ‡‰ç”¨åŸå› **ï¼š

- è»Šè¼›æœ‰ä¸åŒçš„è¡Œç‚ºç­–ç•¥ï¼ˆç›´è¡Œã€è½‰å½ï¼‰
- é‹è¡Œæ™‚éœ€è¦å‹•æ…‹åˆ‡æ›è¡Œç‚º
- æ”¯æ´æ–°è¡Œç‚ºç­–ç•¥çš„æ“´å±•

**å¯¦ç¾æ–¹å¼**ï¼š

```javascript
// ä¸åŒçš„è¡Œç‚ºç­–ç•¥
const strategies = {
  straight: this.executeStraightBehavior,
  left: this.executeLeftTurnBehavior,
  right: this.executeRightTurnBehavior,
  'u-turn': this.executeUTurnBehavior,
}
```

**å„ªé»**ï¼š

- ç®—æ³•å¯ä»¥è‡ªç”±åˆ‡æ›
- é¿å…è¤‡é›œçš„æ¢ä»¶èªå¥
- æ”¯æ´é–‹æ”¾å°é–‰åŸå‰‡

### State Patternï¼ˆç‹€æ…‹æ¨¡å¼ï¼‰

**æ‡‰ç”¨åŸå› **ï¼š

- è»Šè¼›åœ¨æ¨¡æ“¬ä¸­æœ‰ä¸åŒç‹€æ…‹ï¼ˆç­‰å¾…ã€ç§»å‹•ã€è½‰å½ï¼‰
- ç‹€æ…‹è½‰æ›æœ‰æ˜ç¢ºçš„è¦å‰‡
- ä¸åŒç‹€æ…‹ä¸‹çš„è¡Œç‚ºå®Œå…¨ä¸åŒ

**å¯¦ç¾æ–¹å¼**ï¼š

```javascript
// ç‹€æ…‹ç®¡ç†
setState(newState) {
    this.currentState = newState;
    this.stateHandlers[newState]?.call(this);
}
```

**å„ªé»**ï¼š

- ç‹€æ…‹è½‰æ›é‚è¼¯æ¸…æ™°
- æ˜“æ–¼å¢åŠ æ–°ç‹€æ…‹
- æå‡ä»£ç¢¼å¯è®€æ€§

### Command Patternï¼ˆå‘½ä»¤æ¨¡å¼ï¼‰

**æ‡‰ç”¨åŸå› **ï¼š

- å‹•ç•«åŸ·è¡Œéœ€è¦å°è£ç‚ºå‘½ä»¤
- æ”¯æ´å‹•ç•«çš„æš«åœã€æ¢å¾©ã€å–æ¶ˆ
- å¯¦ç¾è¤‡é›œå‹•ç•«åºåˆ—çš„çµ„åˆ

**å¯¦ç¾æ–¹å¼**ï¼š

```javascript
// å‹•ç•«å‘½ä»¤å°è£
executeAnimation(animationCommand) {
    this.currentAnimation = animationCommand;
    animationCommand.execute();
}
```

**å„ªé»**ï¼š

- å‹•ç•«æ§åˆ¶æ›´éˆæ´»
- æ”¯æ´å‹•ç•«çš„æ’¤éŠ·å’Œé‡åš
- æ˜“æ–¼å¯¦ç¾è¤‡é›œå‹•ç•«åºåˆ—

## ğŸš¦ TrafficLight è¨­è¨ˆæ¨¡å¼

### State Patternï¼ˆç‹€æ…‹æ¨¡å¼ï¼‰

**æ‡‰ç”¨åŸå› **ï¼š

- äº¤é€šç‡ˆæœ‰æ˜ç¢ºçš„ç‹€æ…‹ï¼ˆç´…ã€é»ƒã€ç¶ ï¼‰
- ç‹€æ…‹åˆ‡æ›æœ‰å®‰å…¨è¦å‰‡
- ä¸åŒç‹€æ…‹çš„è¦–è¦ºè¡¨ç¾ä¸åŒ

**å¯¦ç¾æ–¹å¼**ï¼š

```javascript
// ç‹€æ…‹åˆ‡æ›
setState(newState) {
    if (this.canTransitionTo(newState)) {
        this.currentState = newState;
        this.updateVisualState();
    }
}
```

**å„ªé»**ï¼š

- ç¢ºä¿å®‰å…¨çš„ç‹€æ…‹è½‰æ›
- ç‹€æ…‹é‚è¼¯é›†ä¸­ç®¡ç†
- æ˜“æ–¼æ“´å±•æ–°ç‹€æ…‹

### Strategy Patternï¼ˆç­–ç•¥æ¨¡å¼ï¼‰

**æ‡‰ç”¨åŸå› **ï¼š

- ä¸åŒç‡ˆè™Ÿçš„é¡¯ç¤ºç­–ç•¥ä¸åŒ
- æ”¯æ´ä¸åŒçš„è¦–è¦ºæ•ˆæœä¸»é¡Œ
- é‹è¡Œæ™‚å‹•æ…‹åˆ‡æ›é¡¯ç¤ºç­–ç•¥

**å¯¦ç¾æ–¹å¼**ï¼š

```javascript
// é¡¯ç¤ºç­–ç•¥
const displayStrategies = {
  normal: this.normalDisplay,
  highlight: this.highlightDisplay,
  minimal: this.minimalDisplay,
}
```

**å„ªé»**ï¼š

- é¡¯ç¤ºé‚è¼¯å¯æ›¿æ›
- æ”¯æ´ä¸»é¡Œåˆ‡æ›
- æ˜“æ–¼æ·»åŠ æ–°çš„é¡¯ç¤ºæ•ˆæœ

## ğŸ”„ æ¨¡å¼å”ä½œ

### æ¨¡å¼é–“çš„å”èª¿

1. **Observer + Factory**ï¼šå·¥å» å‰µå»ºçš„è»Šè¼›è‡ªå‹•è¨»å†Šç‚ºè§€å¯Ÿè€…
2. **State + Strategy**ï¼šåœ¨ä¸åŒç‹€æ…‹ä¸‹æ¡ç”¨ä¸åŒç­–ç•¥
3. **Command + State**ï¼šç‹€æ…‹è½‰æ›é€éå‘½ä»¤æ¨¡å¼è§¸ç™¼
4. **Singleton + Observer**ï¼šå–®ä¾‹æ§åˆ¶å™¨ç®¡ç†æ‰€æœ‰è§€å¯Ÿè€…

### ç³»çµ±æ•´é«”å”èª¿

```javascript
// æ¨¡å¼å”ä½œç¤ºä¾‹
class SystemCoordinator {
  constructor() {
    this.controller = new TrafficLightController() // Singleton
    this.vehicleFactory = new VehicleFactory() // Factory
    this.setupObservers() // Observer
  }

  createVehicle(params) {
    const vehicle = this.vehicleFactory.create(params) // Factory
    this.controller.registerVehicle(vehicle) // Observer
    vehicle.setState('waiting') // State
    return vehicle
  }
}
```

## ğŸ¯ è¨­è¨ˆæ¨¡å¼å¸¶ä¾†çš„å¥½è™•

### ä»£ç¢¼å“è³ªæå‡

- **å¯è®€æ€§**ï¼šæ¨¡å¼æä¾›äº†æ¨™æº–çš„è§£æ±ºæ–¹æ¡ˆ
- **å¯ç¶­è­·æ€§**ï¼šè·è²¬åˆ†é›¢ä½¿ä¿®æ”¹å½±éŸ¿ç¯„åœæœ€å°
- **å¯æ¸¬è©¦æ€§**ï¼šæ¨¡çµ„åŒ–è¨­è¨ˆä¾¿æ–¼å–®å…ƒæ¸¬è©¦
- **å¯é‡ç”¨æ€§**ï¼šæ¨¡å¼åŒ–çš„ä»£ç¢¼æ˜“æ–¼é‡ç”¨

### ç³»çµ±æ¶æ§‹å„ªå‹¢

- **é¬†æ•£è€¦åˆ**ï¼šçµ„ä»¶é–“ä¾è³´é—œä¿‚æœ€å°
- **é«˜å…§èšæ€§**ï¼šç›¸é—œåŠŸèƒ½é›†ä¸­åœ¨ä¸€èµ·
- **å¯æ“´å±•æ€§**ï¼šæ–°åŠŸèƒ½å¯ä»¥ç„¡ç¸«é›†æˆ
- **å¯é…ç½®æ€§**ï¼šé€éç­–ç•¥æ¨¡å¼æ”¯æ´é…ç½®é©…å‹•

### åœ˜éšŠé–‹ç™¼æ•ˆç›Š

- **å…±åŒèªè¨€**ï¼šè¨­è¨ˆæ¨¡å¼æä¾›äº†åœ˜éšŠæºé€šçš„å…±åŒèªè¨€
- **æœ€ä½³å¯¦è¸**ï¼šéµå¾ªæ¥­ç•Œèªå¯çš„æœ€ä½³å¯¦è¸
- **çŸ¥è­˜å‚³æ‰¿**ï¼šæ¨™æº–åŒ–çš„è¨­è¨ˆä¾¿æ–¼çŸ¥è­˜å‚³æ‰¿
- **æ¸›å°‘éŒ¯èª¤**ï¼šæˆç†Ÿçš„æ¨¡å¼æ¸›å°‘è¨­è¨ˆéŒ¯èª¤

é€™äº›è¨­è¨ˆæ¨¡å¼çš„åˆç†æ‡‰ç”¨ï¼Œä½¿å¾—ç³»çµ±å…·å‚™äº†è‰¯å¥½çš„æ¶æ§‹åŸºç¤ï¼Œç‚ºå¾ŒçºŒçš„åŠŸèƒ½æ“´å±•å’Œç¶­è­·æä¾›äº†å¼·æœ‰åŠ›çš„æ”¯æ’ã€‚
